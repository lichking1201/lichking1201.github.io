<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>
		
            menu-aim.js分析
              
	</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="generator" content="Jekyll" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="lichen">
	<meta name="description" content="menu-aim.js的交互效果被广泛运用在淘宝、亚马逊、京东等电商网站的菜单上，体现的效果因为契合直觉仿如天生而不易被用户发觉。但重要性却犹如阿基里斯之踵一般：一旦缺失，就会极大影响用户操作菜单的用户体验。">
	<meta name="keywords" content="menu-aim,javascrtip" />
	<link rel="shortcut icon" href="/assets/ico/favicon.ico">
	<link href="/assets/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/css/prettify.css" rel="stylesheet">
	<link href="/themes/blog/blog.css" rel="stylesheet">
	<!--[if lt IE 9]>
		<script src="/js/ie8-responsive-file-warning.js">
		</script>
	<![endif]-->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js">
		</script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js">
		</script>
	<![endif]-->
</head>

<body id="backtop">
	<div class="blog-masthead">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav">
					<span class="sr-only">导航</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			
			
			<nav class="collapse navbar-collapse blog-nav" id="nav">
				<ul class="nav navbar-nav">
				
				
				
					<li class="">
						<a class="blog-nav-item" href="/index.html">
							首页
						</a>
					</li>
				
				
				
				
					<li class="">
						<a class="blog-nav-item" href="/archive.html">
							文章归档
						</a>
					</li>
				
				
				
				
					<li class="">
						<a class="blog-nav-item" href="/tags.html">
							标签
						</a>
					</li>
				
				
				
				
					<li class="">
						<a class="blog-nav-item" href="/assa.html">
							ASSA
						</a>
					</li>
				
				
				
				
					<li class="">
						<a class="blog-nav-item" href="https://github.com/lichking1201/lichking1201.github.io">
							博客源代码
						</a>
					</li>
				
				
				</ul>
			</nav>
		</div>
	</div>
	<div class="container blog-post">
		<div class="row">
			<div class="col-sm-8 blog-main">
				<h1 class="post-title">
					menu-aim.js分析
				</h1>
				<div class="blog-post-content">
					<h3 id="section">0.楔子</h3>
<p>开始分析前，先看两个现实的用户体验栗子：</p>

<p><em>反面教材：<a href="http://www.zol.com/" title="中关村商城">中关村商城</a></em></p>

<p>设想一个场景，家里想买个新音箱,买之前避免被坑要做个调查吧，看看参数对比下价格。思来想去，还是中关村在线比较靠谱。于是打开中关村在线首页，在首屏的菜单导航中一项一项划过查看，诶，「电脑外设」下面有个「音箱」栏目，OK，就是他了！</p>

<p><img src="/resouse/img/2014-2-24-1.png" alt="示例二" /></p>

<p>正如上图，确认了要指向的目标，相信正常人类<strong>第一反应</strong>都会是沿绿色箭头移动鼠标的吧？但是！</p>

<p><img src="/resouse/img/2014-2-24-2.png" alt="示例二" /></p>

<p>纳尼？！我的音箱呢？！怎么奇怪的东西弹出来了？！我要买的是音箱不是mp3mp4啊！好吧，鼠标回去再来次试试看，纳尼？！还是这样？！F**K，非要我用扭曲的红色路线不成？！摔！坑爹呢这用户体验！直接一点会死嘛会死吗？！</p>

<p><em>正面教材：<a href="http://www.tmall.com/" title="天猫商城">天猫商城</a></em></p>

<p>正面教材就不多说了，请自行体会什么是智能的交互体验。</p>

<!--more-->

<h3 id="menu-aim">1.menu-aim简介</h3>
<p>言归正传，之所以前面两个例子有差异如此大的用户体验，其实就在于这个menu-aim.js上。
menu-aim 是一个应用于下拉菜单的jQuery插件。它的作用是识别用户鼠标划过菜单的意向并作出相应的处置。</p>

<p>这类问题最早是依靠timeout或者delay延迟的方法来解决，设置一个时间阀值，鼠标划过时延迟触发来避免误触的情况。menu-aim在这一基础上做了更优的改进，加入了鼠标路径分析，通过读取鼠标位置，<strong>更准确的</strong>判断用户意图。</p>

<h3 id="section-1">2.原理分析</h3>

<p>说穿了其实很简单，如下图所示：</p>

<p><img src="/resouse/img/2014-2-24-3.png" alt="示例三" /></p>

<p>图中蓝色三角形左边顶点为鼠标移动前的最后位置，右侧顶点连线为与子菜单之间的边界。menu-aim计算当前鼠标位置，如果在蓝色区域内，说明用户的意图是划向子菜单，则不会触发鼠标移动时划过的其他菜单项。</p>

<h3 id="section-2">3.核心代码</h3>

<pre>
	//斜率公式
	function slope(a, b) {
		return (b.y - a.y) / (b.x - a.x);
	};
	
	var decreasingSlope = slope(loc, decreasingCorner),
		increasingSlope = slope(loc, increasingCorner),
		prevDecreasingSlope = slope(prevLoc, decreasingCorner)	,
		prevIncreasingSlope = slope(prevLoc, increasingCorner);

		if (decreasingSlope &lt; prevDecreasingSlope &amp;&amp;
			increasingSlope &gt; prevIncreasingSlope) {
			
		// Mouse is moving from previous location towards the
		// currently activated submenu. Delay before activating a
		// new menu row, because user may be moving into submenu.
		
		lastDelayLoc = loc;
		return DELAY;	
</pre>

<p>分别计算当前（loc）和上一个（lastDelayLoc）鼠标位置与菜单两顶点间连线的斜率，判断当前点是否在上图蓝色三角形内。判断成功，延迟触发事件，该死的子菜单就不会到处乱窜了！</p>

<h3 id="section-3">4.使用说明</h3>
<pre class="prettyprint lang-html">
	@DOM
	&lt;nav&gt;
		&lt;ul class="menu"&gt;
			&lt;li&gt;
				&lt;div&gt;主菜单项一&lt;/div&gt;
				&lt;div&gt;
					&lt;ul class="submenu"&gt;
						&lt;li&gt;子菜单项目1&lt;/li&gt;
						&lt;li&gt;子菜单项目2&lt;/li&gt;
						&lt;li&gt;子菜单项目3&lt;/li&gt;
					&lt;/ul&gt;
				&lt;/div&gt;
			&lt;/li&gt;
			&lt;li&gt;
				&lt;div&gt;主菜单项二&lt;/div&gt;
				&lt;div&gt;
					&lt;ul class="submenu"&gt;
						&lt;li&gt;子菜单项目1&lt;/li&gt;
						&lt;li&gt;子菜单项目2&lt;/li&gt;
						&lt;li&gt;子菜单项目3&lt;/li&gt;
					&lt;/ul&gt;
				&lt;/div&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
	&lt;/nav&gt;
</pre>
<pre class="prettyprint lang-js">	
	@Options
	rowSelector: "&gt; li",  		//要获取的主菜单选项元素
	submenuSelector: "*",		//特殊子菜单元素声明
	submenuDirection: "right",	//子菜单弹出方位，left, right, above,  below 四种可选
	tolerance: 75,  			// y轴误差，数字越大，蓝色三角形右边的长度越大
	enter: $.noop,				//鼠标划入某项时触发的自定义事件
	exit: $.noop,				//鼠标划出某项时触发的自定义事件
	activate: $.noop,			//子菜单弹出动作
	deactivate: $.noop,			//子菜单收回动作
	exitMenu: $.noop			//移出菜单区域触发
	
	@Usage
	$(".menu").menuAim({
		activate: function(){...},
		deactivate: function(){...}
	});
</pre>

<h3 id="section-4">5.其他</h3>
<p>相关文章：<a href="http://bjk5.com/post/44698559168/breaking-down-amazons-mega-dropdown">http://bjk5.com/post/44698559168/breaking-down-amazons-mega-dropdown</a></p>

<p>原版链接：<a href="https://github.com/kamens/jQuery-menu-aim">https://github.com/kamens/jQuery-menu-aim</a></p>

<p>个人注释版Demo下载：<a href="/resouse/attach/jQuery-menu-aim-master.rar">为性能着想，jquery.menu-aim.js350行将$(document)修改为了具体的钩子元素。</a></p>


				</div>
				<hr />
				<p class="post-meta">
					tags:
					
					<a href="/tags.html#前端-ref">前端</a>&ensp;
					
					<a href="/tags.html#js-ref">js</a>&ensp;
					
					&emsp;<time pubdate="2014-02-24">2014-02-24</time>
				</p>
				<!-- Duoshuo Comment BEGIN -->
				<div class="ds-thread"></div>
				<script type="text/javascript">
					var duoshuoQuery = {short_name:"lichking1201"};
					(function() {
						var ds = document.createElement('script');
						ds.type = 'text/javascript';ds.async = true;
						ds.src = 'http://static.duoshuo.com/embed.js';
						ds.charset = 'UTF-8';
						(document.getElementsByTagName('head')[0] 
						|| document.getElementsByTagName('body')[0]).appendChild(ds);
					})();
				</script>
			<!-- Duoshuo Comment END -->
			</div>
			<!--/.blog-main-->
			
			<div class="col-sm-3 col-sm-offset-1 blog-sidebar">
				<div class="sidebar-module">
					<h4>
						最新
					</h4>
					<ol class="list-unstyled">
						
						
						<li><a href="/2014/11/21/how-to-take-photo-to-gf.html">好容易约了女神出去旅行，那么问题来了</a></li>
						
						
						
						<li><a href="/2014/11/01/learn-backbone.html">Backbone 使用总结</a></li>
						
						
						
						<li><a href="/2014/10/16/learningJs.html">系统学习Javascript</a></li>
						
						
						
						<li><a href="/2014/10/11/js-patterns-1.html">Javascript模式 笔记（二） —— 对象与函数的编码模式</a></li>
						
						
						
						<li><a href="/2014/10/11/js-patterns-.html">Javascript模式 笔记（一） —— 概述及基础</a></li>
						
						
						
						
						
						<li><a href="/2014/02/25/myBigdata.html">我的「大数据」挖掘</a></li>
						
						
						
						<li><a href="/2014/02/24/menu-aim.html">menu-aim.js分析</a></li>
						
						
						
						
						
						
					</ol>
				</div>
				<div class="sidebar-module">
					<h4>
						标签
					</h4>
					<ol class="list-unstyled">
					
						<li>
							<a href="../tags.html#生活-ref">
								生活
							</a>
						</li>
					
						<li>
							<a href="../tags.html#前端-ref">
								前端
							</a>
						</li>
					
						<li>
							<a href="../tags.html#文档-ref">
								文档
							</a>
						</li>
					
						<li>
							<a href="../tags.html#js-ref">
								js
							</a>
						</li>
					
						<li>
							<a href="../tags.html#折腾-ref">
								折腾
							</a>
						</li>
					
						<li>
							<a href="../tags.html#笔记-ref">
								笔记
							</a>
						</li>
					
						<li>
							<a href="../tags.html#系统学习JS-ref">
								系统学习JS
							</a>
						</li>
					
					</ol>
				</div>
				<div class="sidebar-module">
					<h4>
						我在
					</h4>
					<ol class="list-unstyled">
						<li>
							<a href="https://github.com/lichking1201" target="_blank">
								GitHub
							</a>
						</li>
						<li>
							<a href="http://www.zhihu.com/people/li-chen-32" target="_blank">
								知乎
							</a>
						</li>
					</ol>
				</div>
			</div>
			<!--/.blog-sidebar-->
		</div>
		<!--/.row-->
	</div>
	<!--/.container-->
	<div class="blog-footer">
		<p>
			© 2014 lichking. with Help from <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>,<a href="http://getbootstrap.com" target="_blank">Twitter Bootstrap</a> and <a href="https://github.com" target="_blank">GitHub</a>.
		</p>
		<p>
			<a href="#backtop">
				Back to top
			</a>
		</p>
	</div>
	<!--Bootstrap core JavaScript==================================================-
	-><!--Placed at the end of the document so the pages load faster-->
	<script src="https://code.jquery.com/jquery-1.10.2.min.js">
	</script>
	<script src="/assets/js/bootstrap.min.js"></script>
	<script src="/assets/js/prettify.js"></script>
 	<script src="/assets/js/docs.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$('pre').addClass('prettyprint');
			prettyPrint();
			
			$('a[href^="http"]').each(function(){
				$(this).attr("target","_blank")
			})
		});
	</script>   
</body>
</html>